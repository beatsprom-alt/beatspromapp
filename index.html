<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Beatsprom Syndicate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0; padding: 0;
            background: #000 url('bg.jpg?v=final_prod_v1') center center no-repeat;
            background-size: cover;
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
        }
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); z-index: 1;
        }
        .content {
            position: relative; z-index: 2; text-align: center; width: 85%;
        }
        .status-box {
            border: 1px solid #ff0000;
            padding: 20px 10px;
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.4);
        }
        .user-name {
            font-size: 24px; color: #ff0000; margin-bottom: 10px;
            text-transform: uppercase; font-weight: bold;
        }
        .label-text {
            font-size: 10px; color: #ffffff; letter-spacing: 2px; font-weight: bold;
        }
        .balance { font-size: 42px; color: #fff; margin: 5px 0; font-weight: bold; }
        .token-name { color: #ff0000; font-size: 18px; }

        .social-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin: 20px 0;
        }
        .social-btn {
            color: #fff; border: 1px solid #333; padding: 12px 0;
            background: rgba(255, 255, 255, 0.1);
            text-transform: uppercase; font-size: 9px;
            cursor: pointer; transition: 0.3s;
            display: block; text-decoration: none;
        }

        /* КНОПКА ФАРМИНГА */
        .mining-zone {
            margin-top: 10px; min-height: 100px;
            border: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.03);
        }
        .farm-btn {
            background: #ff0000; color: #fff; border: none;
            padding: 12px 20px; font-family: inherit; font-weight: bold;
            cursor: pointer; text-transform: uppercase; width: 85%;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
        }
        .timer-text { font-size: 14px; margin-top: 8px; color: #ff0000; font-weight: bold; }
        .progress-bar { width: 85%; height: 6px; background: #222; margin-top: 12px; }
        .progress-fill { height: 100%; background: #ff0000; width: 0%; transition: 0.5s; }
    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="content">
        <div class="status-box">
            <div class="label-text">IDENTIFIED MEMBER:</div>
            <div id="username" class="user-name">BP</div>
            
            <div class="label-text" style="font-size: 9px; margin-top: 10px;">SECURED ASSETS:</div>
            <div class="balance"><span id="main-balance">500</span> <span class="token-name">$CBP</span></div>

            <div class="social-grid">
                <div class="social-btn" onclick="forceOpen('https://x.com/beatspromc')">X</div>
                <div class="social-btn" onclick="forceOpen('https://www.instagram.com/beatsprom?igsh=ZWYwdjA3Zjlhc2Vm')">IG</div>
                <div class="social-btn" onclick="forceOpen('https://youtube.com/@beatsprom?si=jDeWpIzStJoV4CyT')">YT</div>
                <div class="social-btn" onclick="forceOpen('https://www.tiktok.com/@bpcrypt?_r=1&_t=ZS-93srP7kFz7P')">TT</div>
            </div>

            <div class="mining-zone">
                <button id="farm-btn" class="farm-btn" onclick="startFarming()">Start Production</button>
                <div id="mining-info" style="display:none; width: 100%;">
                    <div class="label-text" style="color: #888;">PRODUCING: <span id="farm-amount" style="color:#fff">0.00</span></div>
                    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
                    <div id="timer" class="timer-text">08:00:00</div>
                </div>
            </div>
        </div>
    </div>

   <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    const user = tg.initDataUnsafe?.user;
    document.getElementById('username').innerText = user?.first_name || user?.username || "BP";

    function forceOpen(url) { tg.openLink(url, {try_instant_view: false}); }

    const FARM_DURATION = 8 * 60 * 60 * 1000; 
    const REWARD_PER_SEC = 0.01; 
    let farmInterval;

    // ГЛАВНАЯ ФУНКЦИЯ: ЧИТАЕМ ИЗ ОБЛАКА TELEGRAM
    function initApp() {
        // Запрашиваем данные из облака
        tg.CloudStorage.getItems(['bal', 'start'], (err, values) => {
            let savedBalance = values.bal || '500';
            let startTime = values.start || null;

            document.getElementById('main-balance').innerText = Math.floor(parseFloat(savedBalance));

            if (startTime) {
                const now = Date.now();
                const elapsed = now - parseInt(startTime);
                if (elapsed >= FARM_DURATION) {
                    showClaimButton();
                } else {
                    resumeFarming(parseInt(startTime));
                }
            } else {
                showStartButton();
            }
        });
    }

    function showStartButton() {
        const btn = document.getElementById('farm-btn');
        btn.style.display = 'block';
        btn.innerText = "START PRODUCTION";
        document.getElementById('mining-info').style.display = 'none';
        btn.onclick = startFarming;
    }

    function startFarming() {
        const now = Date.now().toString();
        // Сохраняем в облако время старта
        tg.CloudStorage.setItem('start', now, (err, success) => {
            if (success) resumeFarming(parseInt(now));
        });
    }

    function resumeFarming(startTime) {
        document.getElementById('farm-btn').style.display = 'none';
        document.getElementById('mining-info').style.display = 'block';

        if (farmInterval) clearInterval(farmInterval);

        farmInterval = setInterval(() => {
            const now = Date.now();
            const elapsed = now - startTime;
            const timeLeft = Math.max(0, FARM_DURATION - elapsed);
            const currentMined = (elapsed / 1000) * REWARD_PER_SEC;

            document.getElementById('farm-amount').innerText = currentMined.toFixed(2);
            
            const h = Math.floor(timeLeft / 3600000).toString().padStart(2, '0');
            const m = Math.floor((timeLeft % 3600000) / 60000).toString().padStart(2, '0');
            const s = Math.floor((timeLeft % 60000) / 1000).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${h}:${m}:${s}`;
            document.getElementById('progress-fill').style.width = Math.min(100, (elapsed / FARM_DURATION) * 100) + '%';

            if (elapsed >= FARM_DURATION) {
                clearInterval(farmInterval);
                showClaimButton();
            }
        }, 1000);
    }

    function showClaimButton() {
        const totalReward = (FARM_DURATION / 1000) * REWARD_PER_SEC;
        document.getElementById('mining-info').style.display = 'none';
        const btn = document.getElementById('farm-btn');
        btn.style.display = 'block';
        btn.innerText = `CLAIM ${totalReward.toFixed(2)} $CBP`;
        btn.onclick = () => claimReward(totalReward);
    }

    function claimReward(amount) {
        tg.CloudStorage.getItems(['bal'], (err, values) => {
            let currentBal = parseFloat(values.bal || '500');
            currentBal += amount;
            
            // Сохраняем новый баланс и удаляем время старта в облаке
            tg.CloudStorage.setItem('bal', currentBal.toString());
            tg.CloudStorage.removeItem('start', (err, success) => {
                initApp();
            });
        });
    }

    initApp();
</script>
</html>



